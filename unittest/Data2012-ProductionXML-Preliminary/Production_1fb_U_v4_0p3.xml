<RapidFit>

//================================================
// Formal Parameters to be fitted or fixed

<ParameterSet>


//........................................
// Parameters which can be fixed for Scans

//Fractions

<PhysicsParameter>
<Name>SignalFractionUBU</Name>
<Value>0.68</Value>
<Minimum>0.0</Minimum>
<Maximum>1.0</Maximum>
<Type>Free</Type>           
<Unit>Unitless</Unit>
</PhysicsParameter>

//Fraction of signal in total sample
<PhysicsParameter>
<Name>SignalFractionUBT</Name>
<Value>0.62</Value>
<Minimum>0.0</Minimum>
<Maximum>1.0</Maximum>
<Type>Free</Type>           
<Unit>Unitless</Unit>
</PhysicsParameter>

// Mass

<PhysicsParameter>
<Name>alphaM_pr</Name>      
<Value>0.0017</Value>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>f_sig_m1</Name>      
<Value>0.83</Value>
<Minimum>0.0</Minimum>
<Maximum>1.00001</Maximum>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>sigma_m1</Name>      
<Value>6.45</Value>
<Minimum>0.0</Minimum>
<Maximum>100.0</Maximum>
<Type>Free</Type>
<Unit>MeV/c^{2}</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>ratio_21</Name>
<Value>2.14</Value>
<Minimum>1.0</Minimum>
<Maximum>10.0</Maximum>
<Type>Fixed</Type>
<Unit>MeV/c^{2}</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>m_Bs</Name>
<Value>5368.0</Value>
<Type>Free</Type>
<Unit>MeV/c^{2}</Unit>
</PhysicsParameter>

// LL lifetimes

<PhysicsParameter>
<Name>f_LL1</Name>          
<Value>0.99285</Value>
<Minimum>0.0</Minimum>
<Maximum>1.0</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>tau_LL1</Name>        
<Value>0.15</Value>
<Minimum>0.01</Minimum>
<Maximum>0.5</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>tau_LL2</Name>        
<Value>1.0</Value>
<Minimum>0.05</Minimum>
<Maximum>3.0</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>



//..........................................
// Parameters which cant be fixed for scans

// True Physics Parameters for signal 

<PhysicsParameter>
<Name>gamma</Name>
<Value>0.67</Value>
<Minimum>0.0</Minimum>
<Maximum>2.0</Maximum>
<Type>Free</Type>
<Unit>ps^{-1}</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>deltaGamma</Name>
<Value>0.13</Value>   
<Minimum>-0.1</Minimum>
<Maximum>0.3</Maximum>
<Type>Free</Type>
<Unit>ps^{-1}</Unit>
<BlindString>BsRooBarbMoriond2012</BlindString>
<BlindScale>0.02</BlindScale>
</PhysicsParameter>

<PhysicsParameter>
<Name>Aperp_sq</Name>
<Value>0.25</Value>
<Minimum>0.</Minimum>
<Maximum>0.5</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>Azero_sq</Name>
<Value>0.50</Value>
<Type>Free</Type>
<Minimum>0.</Minimum>
<Maximum>0.8</Maximum>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>As_sq</Name>
<Value>0.02</Value>
<Minimum>0.</Minimum>
<Maximum>0.25</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_para</Name>
<Value>3.3</Value>  
<Maximum>6.3</Maximum>
<Minimum>-6.3</Minimum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_perp</Name>
<Value>2.9</Value> 
<Minimum>-6.3</Minimum>
<Maximum>6.3</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_zero</Name>
<Value>0.0</Value>
<Minimum>-3.3</Minimum>
<Maximum>3.3</Maximum>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_s</Name>
<Value>2.9</Value>
<Minimum>-6.3</Minimum>
<Maximum>6.3</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>              
<Name>deltaM</Name>
<Value>17.63</Value>
<Type>Free</Type>
<Unit>ps-1</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>Phi_s</Name>
<Value>0.19</Value>  
<Type>Free</Type>
<Unit>Unitless</Unit>
<BlindString>BsCustardMoriond2012</BlindString>
<BlindScale>0.3</BlindScale>
</PhysicsParameter>





//..................................
// Detector Parameters

//Signal PDF time resolution parameters for double gaussian model. 

<PhysicsParameter>
<Name>timeResolutionScale</Name>     
<Value>1.45</Value>                      
<Type>Free</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution1</Name>           
<Value>0.0434</Value>                   
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution2</Name>
<Value>0.0853</Value> 
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution3</Name>
<Value>0.513</Value> 
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution2Fraction</Name>     
<Value>0.165</Value>                      
<Type>Fixed</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution3Fraction</Name>     
<Value>0.0017</Value>                      
<Type>Fixed</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeOffset</Name>                 //Leave at Zero, this is not used anywhere yet.
<Value>0.000</Value>
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>


// Angular acceptance factors

<PhysicsParameter>
<Name>angAccI1</Name>
#<Value>1.0</Value>   
<Value>0.9795</Value>   
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI2</Name>
#<Value>1.0</Value>   
<Value>1.0294</Value>  
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI3</Name>
#<Value>1.0</Value>  
<Value>1.0313</Value>  
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>  
<Name>angAccI4</Name>
#<Value>0.0</Value>     
<Value>-0.0041</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI5</Name>
#<Value>0.0</Value>   
<Value>0.0001</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI6</Name>
#<Value>0.0</Value>    
<Value>-0.0011</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI7</Name>
#<Value>1.0</Value>
<Value>0.9925</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI8</Name>
#<Value>0.0</Value>
<Value>0.0003</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI9</Name>
#<Value>0.0</Value>
<Value>-0.0005</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI10</Name>
#<Value>0.0</Value>
<Value>-0.0075</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

// Mistag parameters

// Mistag calibration
<PhysicsParameter>
<Name>mistagP1</Name>
<Value>1.023</Value>
<Type>Free</Type>
<Unit> </Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>mistagP0</Name>
<Value>0.393</Value>
<Type>Free</Type>
<Unit> </Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>mistagSetPoint</Name>
<Value>0.393</Value>
<Type>Fixed</Type>
<Unit> </Unit>
</PhysicsParameter>

//............................................
// Background model

//Long lived time resolution components

<PhysicsParameter>
<Name>timeResLL1Frac</Name>
<Value>1.0</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>sigma_LL1</Name>
<Value>0.00</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>sigma_LL2</Name>
<Value>0.00</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>


</ParameterSet>


//==========================================
// Specify which minimiser to use.

<Minimiser>
<MinimiserName>Minuit</MinimiserName>
<MaxSteps>100000</MaxSteps>
<GradTolerance>0.0001</GradTolerance>
<Quality>1</Quality>
</Minimiser>

<FitFunction>
<FunctionName>NegativeLogLikelihood</FunctionName>
#<Threads>3</Threads>
#<Strategy>Petes</Strategy>
</FitFunction>


<NumberRepeats>1</NumberRepeats>



//==========================================
// Specify the fit

//...................................
// This applies a constraint on deltaM
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>deltaM</Name>
<Value>17.63</Value>
<Error>0.11</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>timeResolutionScale</Name>
<Value>1.45</Value>
<Error>0.06</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

// This applies a constraint on mistag scale
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>mistagP1</Name>
<Value>1.023</Value>
<Error>0.04</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>mistagP0</Name>
<Value>0.393</Value>
<Error>0.007</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>


// ....................
// Attempt to constrain LLscan on the amplitudes
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>ATOTAL</Name>
<Value>1.0</Value>
<Error>0.00001</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

// ....................
// Attempt to constrain GH and GL positive
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>GLandGH</Name>
<Value>0.0</Value>
<Error>0.00001</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>


//========================================
// UN-BIASED UN-TAGGED events

<ToFit>

<NormalisedSumPDF>
<FractionName>SignalFractionUBU</FractionName>
<ProdPDF>
<PDF>
<Name>Bs2JpsiPhi_SignalAlt_MO_v4</Name>
<ConfigurationParameter>UseTimeAcceptance:True</ConfigurationParameter>
<ConfigurationParameter>TimeAcceptanceFile:2011-1fb-timeAcceptance-v5-Bs-40b.txt</ConfigurationParameter>
<ParameterSubstitution>tag:tagdecision_os</ParameterSubstitution>
<ParameterSubstitution>mistag:tagomega_os</ParameterSubstitution>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
<ConfigurationParameter>UseEventResolution:True</ConfigurationParameter>
<ParameterSubstitution>eventResolution:sigmat</ParameterSubstitution>
</PDF>
<PDF>
<Name>BsMass</Name>
</PDF>
</ProdPDF>
<ProdPDF>
<PDF>
<Name>LongLivedBkg_3Dangular</Name>
<ConfigurationParameter>AngularDistributionHistogram:2011-1fb-backgroundangles-0p3-v1.root</ConfigurationParameter>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
</PDF>
<PDF>
<Name>Bs2JpsiPhiMassBkg</Name>
</PDF>
</ProdPDF>
</NormalisedSumPDF>


<DataSet>
<Source>File</Source>
<FileName>$RAPIDFITDATA/Bs2JpsiPhi_ntupleB_for_fitting_20120120.root</FileName>  
<NTuplePath>DecayTree</NTuplePath>
<CutString>(sel==1)&&(triggerDecision==1)&&(12.>abs(mdau2-1020))</CutString>
<NumberEvents>10000000</NumberEvents>

<PhaseSpaceBoundary>
<Observable>
<Name>time</Name>
<Minimum>0.3</Minimum> 
<Maximum>14.0</Maximum>
<Unit>ps</Unit>
</Observable>

<Observable>
<Name>trcostheta</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>trphi</Name>
<Minimum>-3.14159</Minimum>
<Maximum>3.14159</Maximum>
<Unit>rad</Unit>
</Observable>

<Observable>
<Name>trcospsi</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagdecision_os</Name>
<Value>0.0</Value>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagomega_os</Name>
<Minimum>0.4999999</Minimum>
<Maximum>0.6</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>mass</Name>
<Minimum>5200.0</Minimum>
<Maximum>5550.0</Maximum>
<Unit>MeV/c^{2}</Unit>
</Observable>

<Observable>
<Name>sigmat</Name>
<Minimum>0.0</Minimum>
<Maximum>0.12</Maximum>
<Unit> </Unit>
</Observable>


</PhaseSpaceBoundary>
</DataSet>
</ToFit>


//========================================
// UN-BIASED OS TAGGED events

<ToFit>

<NormalisedSumPDF>
<FractionName>SignalFractionUBT</FractionName>
<ProdPDF>
<PDF>
<Name>Bs2JpsiPhi_SignalAlt_MO_v4</Name>
<ConfigurationParameter>UseTimeAcceptance:True</ConfigurationParameter>
<ConfigurationParameter>TimeAcceptanceFile:2011-1fb-timeAcceptance-v5-Bs-40b.txt</ConfigurationParameter>
<ParameterSubstitution>tag:tagdecision_os</ParameterSubstitution>
<ParameterSubstitution>mistag:tagomega_os</ParameterSubstitution>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
<ConfigurationParameter>UseEventResolution:True</ConfigurationParameter>
<ParameterSubstitution>eventResolution:sigmat</ParameterSubstitution>
</PDF>
<PDF>
<Name>BsMass</Name>
</PDF>
</ProdPDF>
<ProdPDF>
<PDF>
<Name>LongLivedBkg_3Dangular</Name>
<ConfigurationParameter>AngularDistributionHistogram:2011-1fb-backgroundangles-0p3-v1.root</ConfigurationParameter>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
</PDF>
<PDF>
<Name>Bs2JpsiPhiMassBkg</Name>
</PDF>
</ProdPDF>
</NormalisedSumPDF>

<DataSet>
<Source>File</Source>
<FileName>$RAPIDFITDATA/Bs2JpsiPhi_ntupleB_for_fitting_20120120.root</FileName>  
<NTuplePath>DecayTree</NTuplePath>
<CutString>(sel==1)&&(triggerDecision==1)&&(12.>abs(mdau2-1020))</CutString>
<NumberEvents>10000000</NumberEvents>

<PhaseSpaceBoundary>
<Observable>
<Name>time</Name>
<Minimum>0.3</Minimum> 
<Maximum>14.0</Maximum>
<Unit>ps</Unit>
</Observable>

<Observable>
<Name>trcostheta</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>trphi</Name>
<Minimum>-3.14159</Minimum>
<Maximum>3.14159</Maximum>
<Unit>rad</Unit>
</Observable>

<Observable>
<Name>trcospsi</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagdecision_os</Name>
<Value>1.0</Value>
<Value>-1.0</Value>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagomega_os</Name>
<Minimum>0.000001</Minimum>
<Maximum>0.499999</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>mass</Name>
<Minimum>5200.0</Minimum>
<Maximum>5550.0</Maximum>
<Unit>MeV/c^{2}</Unit>
</Observable>

<Observable>
<Name>sigmat</Name>
<Minimum>0.0</Minimum>
<Maximum>0.12</Maximum>
<Unit> </Unit>
</Observable>



</PhaseSpaceBoundary>
</DataSet>
</ToFit>

<Output>
       <Scan>                                                                                                                                                        
                <Name>deltaM</Name>                                                                                                                               
                <Minimum>10.0</Minimum>                                                                                                                              
                <Maximum>25.0</Maximum>                                                                                                                               
                <Points>11</Points>                                                                                                                                    
        </Scan>   
</Output>



</RapidFit>
