<RapidFit>

//================================================
// Formal Parameters to be fitted or fixed

<ParameterSet>

//..........................................
// Parameters which cant be fixed for scans

// True Physics Parameters for signal 

<PhysicsParameter>
<Name>gamma</Name>
<Value>0.67</Value>
<Minimum>0.0</Minimum>
<Maximum>2.0</Maximum>
<Type>Free</Type>
<Unit>ps^{-1}</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>deltaGamma</Name>
<Value>0.13</Value>   
<Minimum>-0.1</Minimum>
<Maximum>0.3</Maximum>
<Type>Free</Type>
<Unit>ps^{-1}</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>Aperp_sq</Name>
<Value>0.25</Value>
<Minimum>0.</Minimum>
<Maximum>0.5</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>Azero_sq</Name>
<Value>0.50</Value>
<Type>Free</Type>
<Minimum>0.</Minimum>
<Maximum>0.8</Maximum>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>As_sq</Name>
<Value>0.02</Value>
<Minimum>0.</Minimum>
<Maximum>0.25</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_para</Name>
<Value>3.3</Value>  
<Maximum>6.3</Maximum>
<Minimum>-6.3</Minimum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_perp</Name>
<Value>2.9</Value> 
<Minimum>-6.3</Minimum>
<Maximum>6.3</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_zero</Name>
<Value>0.0</Value>
<Minimum>-3.3</Minimum>
<Maximum>3.3</Maximum>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>delta_s</Name>
<Value>2.9</Value>
<Minimum>-6.3</Minimum>
<Maximum>6.3</Maximum>
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>              
<Name>deltaM</Name>
<Value>17.63</Value>
<Type>Free</Type>
<Unit>ps-1</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>Phi_s</Name>
<Value>0.19</Value>  
<Type>Free</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>





//..................................
// Detector Parameters

//Signal PDF time resolution parameters for double gaussian model. 

<PhysicsParameter>
<Name>timeResolutionScale</Name>     
<Value>1.45</Value>                      
<Type>Free</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution1</Name>           
<Value>0.0434</Value>                   
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution2</Name>
<Value>0.0853</Value> 
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution3</Name>
<Value>0.513</Value> 
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution2Fraction</Name>     
<Value>0.165</Value>                      
<Type>Fixed</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeResolution3Fraction</Name>     
<Value>0.0017</Value>                      
<Type>Fixed</Type>
<Unit>unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>timeOffset</Name>                 //Leave at Zero, this is not used anywhere yet.
<Value>0.000</Value>
<Type>Fixed</Type>
<Unit>ps</Unit>
</PhysicsParameter>


// Angular acceptance factors

<PhysicsParameter>
<Name>angAccI1</Name>
#<Value>1.0</Value>   
<Value>0.9792</Value>   
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI2</Name>
#<Value>1.0</Value>   
<Value>1.0296</Value>  
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI3</Name>
#<Value>1.0</Value>  
<Value>1.0319</Value>  
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>  
<Name>angAccI4</Name>
#<Value>0.0</Value>     
<Value>-0.0035</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI5</Name>
#<Value>0.0</Value>   
<Value>0.0001</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI6</Name>
#<Value>0.0</Value>    
<Value>-0.0010</Value>    
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI7</Name>
#<Value>1.0</Value>
<Value>0.9927</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI8</Name>
#<Value>0.0</Value>
<Value>0.0003</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI9</Name>
#<Value>0.0</Value>
<Value>-0.0003</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>angAccI10</Name>
#<Value>0.0</Value>
<Value>-0.0078</Value>
<Type>Fixed</Type>
<Unit>Unitless</Unit>
</PhysicsParameter>

// Mistag parameters



// Mistag calibration
<PhysicsParameter>
<Name>mistagP1</Name>
<Value>1.035</Value>
<Type>Free</Type>
<Unit> </Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>mistagP0</Name>
<Value>0.392</Value>
<Type>Free</Type>
<Unit> </Unit>
</PhysicsParameter>

<PhysicsParameter>
<Name>mistagSetPoint</Name>
<Value>0.391</Value>
<Type>Fixed</Type>
<Unit> </Unit>
</PhysicsParameter>



</ParameterSet>


//==========================================
// Specify which minimiser to use.

<Minimiser>
<MinimiserName>Minuit</MinimiserName>
<MaxSteps>100000</MaxSteps>
<GradTolerance>0.0001</GradTolerance>
<Quality>1</Quality>
</Minimiser>

<FitFunction>
<WeightName>sWeight</WeightName>
<FunctionName>NegativeLogLikelihoodThreaded</FunctionName>
<Threads>128</Threads>
#<Strategy>Petes</Strategy>
</FitFunction>


<NumberRepeats>1</NumberRepeats>



//==========================================
// Specify the fit

//...................................
// This applies a constraint on deltaM
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>deltaM</Name>
<Value>17.63</Value>
<Error>0.11</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>timeResolutionScale</Name>
<Value>1.45</Value>
<Error>0.06</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

// This applies a constraint on mistag scale
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>mistagP1</Name>
<Value>1.035</Value>
<Error>0.024</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>mistagP0</Name>
<Value>0.392</Value>
<Error>0.009</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>


// ....................
// Attempt to constrain the amplitudes
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>ATOTAL</Name>
<Value>1.0</Value>
<Error>0.00001</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>

// ....................
// Attempt to constrain GH and GL positive
<ToFit>
<ConstraintFunction>
<ExternalConstraint>
<Name>GLandGH</Name>
<Value>0.0</Value>
<Error>0.00001</Error>
</ExternalConstraint>
</ConstraintFunction>
</ToFit>


//========================================
// UN-TAGGED events

<ToFit>

<PDF>
<Name>Bs2JpsiPhi_SignalAlt_MO_v4</Name>
<ConfigurationParameter>UseTimeAcceptance:True</ConfigurationParameter>
<ConfigurationParameter>TimeAcceptanceFile:2011-1fb-timeAcceptance-v5-Bs-40b.txt</ConfigurationParameter>
<ConfigurationParameter>UseEventResolution:True</ConfigurationParameter>
<ParameterSubstitution>tag:tagdecision_os</ParameterSubstitution>
<ParameterSubstitution>mistag:tagomega_os</ParameterSubstitution>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
<ParameterSubstitution>eventResolution:sigmat</ParameterSubstitution>
</PDF>


<DataSet>
<Source>File</Source>
<FileName>Bs2JpsiPhi_ntupleB_for_fitting_20120203_sWeighted_0p3.root</FileName>
<NumberEvents>10000000</NumberEvents>

<PhaseSpaceBoundary>
<Observable>
<Name>time</Name>
<Minimum>0.3</Minimum> 
<Maximum>14.0</Maximum>
<Unit>ps</Unit>
</Observable>

<Observable>
<Name>trcostheta</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>trphi</Name>
<Minimum>-3.14159</Minimum>
<Maximum>3.14159</Maximum>
<Unit>rad</Unit>
</Observable>

<Observable>
<Name>trcospsi</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagdecision_os</Name>
<Value>0.0</Value>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagomega_os</Name>
<Minimum>0.4999999</Minimum>
<Maximum>0.5000001</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>sigmat</Name>
<Minimum>0.0</Minimum>
<Maximum>0.12</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>sWeight</Name>
<Minimum>-50.0</Minimum>
<Maximum>50.0</Maximum>
<Unit> </Unit>
</Observable>


</PhaseSpaceBoundary>
</DataSet>
</ToFit>


//========================================
// OS TAGGED events

<ToFit>

<PDF>
<Name>Bs2JpsiPhi_SignalAlt_MO_v4</Name>
<ConfigurationParameter>UseTimeAcceptance:True</ConfigurationParameter>
<ConfigurationParameter>TimeAcceptanceFile:2011-1fb-timeAcceptance-v5-Bs-40b.txt</ConfigurationParameter>
<ConfigurationParameter>UseEventResolution:True</ConfigurationParameter>
<ParameterSubstitution>tag:tagdecision_os</ParameterSubstitution>
<ParameterSubstitution>mistag:tagomega_os</ParameterSubstitution>
<ParameterSubstitution>cosTheta:trcostheta</ParameterSubstitution>
<ParameterSubstitution>cosPsi:trcospsi</ParameterSubstitution>
<ParameterSubstitution>phi:trphi</ParameterSubstitution>
<ParameterSubstitution>eventResolution:sigmat</ParameterSubstitution>
</PDF>

<DataSet>
<Source>File</Source>
<FileName>Bs2JpsiPhi_ntupleB_for_fitting_20120203_sWeighted_0p3.root</FileName>  
<NumberEvents>10000000</NumberEvents>

<PhaseSpaceBoundary>
<Observable>
<Name>time</Name>
<Minimum>0.3</Minimum> 
<Maximum>14.0</Maximum>
<Unit>ps</Unit>
</Observable>

<Observable>
<Name>trcostheta</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>trphi</Name>
<Minimum>-3.14159</Minimum>
<Maximum>3.14159</Maximum>
<Unit>rad</Unit>
</Observable>

<Observable>
<Name>trcospsi</Name>
<Minimum>-1.0</Minimum>
<Maximum>1.0</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagdecision_os</Name>
<Value>1.0</Value>
<Value>-1.0</Value>
<Unit> </Unit>
</Observable>

<Observable>
<Name>tagomega_os</Name>
<Minimum>0.000001</Minimum>
<Maximum>0.499999</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>sigmat</Name>
<Minimum>0.0</Minimum>
<Maximum>0.12</Maximum>
<Unit> </Unit>
</Observable>

<Observable>
<Name>sWeight</Name>
<Minimum>-50.0</Minimum>
<Maximum>50.0</Maximum>
<Unit> </Unit>
</Observable>

</PhaseSpaceBoundary>
</DataSet>
</ToFit>


<Output>
       <Scan>                                                                                                                                                        
                <Name>deltaM</Name>                                                                                                                               
                <Minimum>10.0</Minimum>                                                                                                                              
                <Maximum>25.0</Maximum>                                                                                                                               
                <Points>11</Points>                                                                                                                                    
        </Scan>   
</Output>



</RapidFit>
